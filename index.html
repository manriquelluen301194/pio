import React, { useState, useEffect, useMemo } from 'react';
import { 
  Utensils, 
  ShoppingBag, 
  Plus, 
  Minus, 
  Phone, 
  MessageCircle, 
  Clock, 
  Trash2
} from 'lucide-react';

// Datos del Men√∫
const MENU_DATA = {
  broaster: [
    { id: 'b1', name: 'EL DESPECHADO', description: 'PECHO BROASTER + PAPAS + ENSALADA', price: 15, emoji: 'üçó' },
    { id: 'b2', name: 'EL COJO', description: 'PIERNA BROASTER + PAPAS + ENSALADA', price: 15, emoji: 'üçó' },
    { id: 'b3', name: 'FOREVER-AL√ìN', description: 'ALA BROASTER + PAPAS + ENSALADA', price: 15, emoji: 'üçó' }
  ],
  salchipapas: [
    { id: 's1', name: 'SALCHI FIEL (CL√ÅSICA)', description: 'PAPAS + HOT DOG', price: 13, emoji: 'üå≠' },
    { id: 's2', name: 'SALCHI DE CONO (A LO POBRE)', description: 'PAPAS + HOT DOG + HUEVO + PL√ÅTANO', price: 15, emoji: 'ü•î' },
    { id: 's3', name: 'SALCHI INFIEL', description: 'PAPAS + HOTDOG + DOBLE HUEVO', price: 15, emoji: 'üå≠' },
    { id: 's4', name: 'SALCHI CALLAO', description: 'PAPAS + HARTO CHORIZO', price: 15, emoji: 'üå≠' },
    { id: 's5', name: 'SALCHI MECHUDA', description: 'PAPAS + HOT DOG + POLLO DESILACHADO', price: 15, emoji: 'üå≠' }
  ],
  bebidas: [
    { id: 'be1', name: 'INKA COLA', description: 'SODA EN LATA', price: 2, emoji: 'ü•§' },
    { id: 'be2', name: 'COCA-COLA', description: 'SODA EN LATA', price: 2, emoji: 'ü•§' },
    { id: 'be3', name: 'CHICHA TU MARE', description: 'VASO DE CHICHA MORADA', price: 5, emoji: 'üçπ' }
  ],
  postres: [
    { id: 'p1', name: 'LA VOLTEADA', description: 'CREMA VOLTEADA', price: 5, note: '*S√ÅB. Y DOM.', emoji: 'üçÆ' },
    { id: 'p2', name: 'FLAN', description: 'FLAN CASERO', price: 5, note: '*S√ÅB. Y DOM.', emoji: 'üç∞' },
    { id: 'p3', name: 'ME QUIERO CASAR', description: 'ARROZ CON LECHE', price: 5, note: '*S√ÅB. Y DOM.', emoji: 'üçö' }
  ]
};

// Configuraci√≥n de Identidad
const LOGO_ID = '1vM3RJvT1QwdYO3jKlfTOdmDr_7j5hs4r';
const LOGO_URL = `https://lh3.googleusercontent.com/u/0/d/${LOGO_ID}=w1000-h1000`;
const WHATSAPP_NUMBER = "13292039467";

const LogoImage = ({ className, alt }) => {
  const [error, setError] = useState(false);
  
  if (error) {
    return (
      <div className={`${className} bg-neutral-900 flex items-center justify-center text-red-600 font-black text-[10px] text-center p-2 uppercase border border-red-900/20 rounded-full`}>
        POLLO
      </div>
    );
  }

  return (
    <img 
      src={LOGO_URL} 
      alt={alt} 
      className={className}
      style={{ mixBlendMode: 'screen' }} 
      onError={() => setError(true)}
      loading="lazy"
    />
  );
};

export default function App() {
  const [cart, setCart] = useState({});
  const [deliveryType, setDeliveryType] = useState('recoger');
  const [tip, setTip] = useState(0);
  const [customerInfo, setCustomerInfo] = useState({ name: '', phone: '', address: '' });
  const [scrolled, setScrolled] = useState(false);

  // Efecto para el header pegajoso
  useEffect(() => {
    const handleScroll = () => {
      setScrolled(window.scrollY > 50);
    };
    window.addEventListener('scroll', handleScroll, { passive: true });
    return () => window.removeEventListener('scroll', handleScroll);
  }, []);

  const updateQuantity = (item, delta) => {
    setCart(prev => {
      const currentQty = prev[item.id]?.quantity || 0;
      const newQty = Math.max(0, currentQty + delta);
      if (newQty === 0) {
        const { [item.id]: _, ...rest } = prev;
        return rest;
      }
      return { ...prev, [item.id]: { ...item, quantity: newQty } };
    });
  };

  const cartValues = useMemo(() => {
    const subtotal = Object.values(cart).reduce((acc, item) => acc + (item.price * item.quantity), 0);
    const count = Object.values(cart).reduce((acc, item) => acc + item.quantity, 0);
    return { subtotal, total: subtotal + (deliveryType === 'delivery' ? tip : 0), count };
  }, [cart, tip, deliveryType]);

  const sendOrder = () => {
    if (cartValues.count === 0) return;
    if (deliveryType === 'delivery' && (!customerInfo.name || !customerInfo.phone || !customerInfo.address)) {
      alert("Por favor completa los datos de entrega");
      return;
    }

    let message = 'üçó *PEDIDO - SE ESCAP√ì EL POLLO* üçó\n\n';
    message += 'üìã *DETALLE:*\n';
    Object.values(cart).forEach(item => {
      message += `‚Ä¢ ${item.name} (x${item.quantity}) - $${item.price * item.quantity}\n`;
    });
    
    message += `\nüí∞ *SUBTOTAL: $${cartValues.subtotal}*`;
    
    if (deliveryType === 'recoger') {
      message += '\nüè™ *TIPO: RECOGER EN TIENDA*';
    } else {
      message += '\nüöó *TIPO: DELIVERY*';
      message += `\nüë§ *Cliente:* ${customerInfo.name.toUpperCase()}`;
      message += `\nüìû *Cel:* ${customerInfo.phone}`;
      message += `\nüìç *Dir:* ${customerInfo.address.toUpperCase()}`;
      message += `\nüî• *TOTAL: $${cartValues.total}*`;
    }

    const whatsappUrl = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(message)}`;
    window.open(whatsappUrl, '_blank');
  };

  return (
    <div className="min-h-screen bg-[#050505] text-neutral-100 selection:bg-red-600/30 font-sans overflow-x-hidden pt-safe">
      
      {/* Header Optimizado */}
      <header className={`fixed top-0 w-full z-50 transition-all duration-300 px-4 pt-safe ${
        scrolled ? 'py-3 bg-black/80 backdrop-blur-xl border-b border-white/5' : 'py-6 bg-transparent'
      }`}>
        <div className="max-w-7xl mx-auto flex justify-between items-center">
          <div className="flex items-center gap-3">
            <LogoImage 
              className={`transition-all duration-500 ${scrolled ? 'w-10 h-10 rotate-0' : 'w-0 h-0 -rotate-90 opacity-0'}`}
              alt="Mini Logo"
            />
            <div className="flex flex-col">
              <h1 className="font-black text-sm sm:text-xl tracking-tighter uppercase leading-none">
                SE ESCAP√ì EL POLLO
              </h1>
              <span className="text-[10px] text-red-600 font-black tracking-widest mt-1">NEW JERSEY</span>
            </div>
          </div>
          
          <a href={`tel:${WHATSAPP_NUMBER}`} className="bg-white text-black px-4 py-2 rounded-full font-black text-xs hover:bg-red-600 hover:text-white transition-all active:scale-95 flex items-center gap-2">
            <Phone size={14} strokeWidth={3} />
            <span className="hidden xs:inline">PEDIR YA</span>
          </a>
        </div>
      </header>

      {/* Hero Section Minimalista */}
      <section className="relative h-[80vh] flex flex-col items-center justify-center text-center px-6">
        <div className="absolute inset-0 bg-gradient-to-b from-red-600/5 to-transparent pointer-events-none" />
        
        <div className="relative z-10 space-y-8 animate-in fade-in zoom-in duration-1000">
          <LogoImage 
            className="w-56 h-56 sm:w-80 sm:h-80 mx-auto drop-shadow-[0_0_80px_rgba(220,38,38,0.2)]"
            alt="Logo Principal"
          />
          
          <div className="space-y-2">
            <h2 className="text-4xl sm:text-7xl font-black tracking-tighter uppercase leading-[0.9]">
              EL SABOR <br /> <span className="text-red-600">QUE SE ESCAPA</span>
            </h2>
            <p className="text-neutral-500 font-bold tracking-[0.4em] text-[10px] sm:text-xs">AUT√âNTICO BROASTER PERUANO</p>
          </div>
        </div>
        
        <div className="absolute bottom-10 left-1/2 -translate-x-1/2 animate-bounce">
          <div className="w-px h-12 bg-gradient-to-b from-neutral-800 to-transparent" />
        </div>
      </section>

      {/* Grid de Men√∫ */}
      <main className="max-w-7xl mx-auto px-4 sm:px-8 pb-32 grid grid-cols-1 lg:grid-cols-12 gap-12 relative">
        <div className="lg:col-span-8 space-y-24">
          {Object.entries(MENU_DATA).map(([category, items]) => (
            <div key={category} id={category} className="scroll-mt-32">
              <h3 className="text-3xl sm:text-5xl font-black uppercase tracking-tighter mb-12 flex items-center gap-4">
                <span className="w-12 h-1 bg-red-600 rounded-full" />
                {category}
              </h3>
              
              <div className="grid grid-cols-1 sm:grid-cols-2 gap-6">
                {items.map((item) => (
                  <div key={item.id} className="group bg-neutral-900/20 border border-white/5 rounded-[2.5rem] p-6 sm:p-8 hover:bg-neutral-900/50 hover:border-red-600/30 transition-all duration-500 flex flex-col justify-between">
                    <div>
                      <div className="flex justify-between items-start mb-8">
                        <div className="text-4xl sm:text-5xl bg-neutral-900 rounded-3xl w-16 h-16 sm:w-20 sm:h-20 flex items-center justify-center border border-white/5 group-hover:scale-110 transition-transform duration-500">
                          {item.emoji}
                        </div>
                        <div className="bg-red-600/10 text-red-500 px-4 py-2 rounded-2xl font-black text-xl">
                          ${item.price}
                        </div>
                      </div>
                      <h4 className="text-xl sm:text-2xl font-black uppercase mb-3 tracking-tight">{item.name}</h4>
                      <p className="text-neutral-500 text-xs sm:text-sm font-medium leading-relaxed">{item.description}</p>
                      {item.note && (
                        <p className="text-red-500 text-[9px] font-black mt-4 tracking-widest uppercase">{item.note}</p>
                      )}
                    </div>
                    
                    <div className="mt-8 flex items-center gap-2 bg-black/40 p-2 rounded-3xl border border-white/5">
                      <button 
                        onClick={() => updateQuantity(item, -1)}
                        className="flex-1 h-12 flex items-center justify-center rounded-2xl bg-neutral-800 hover:bg-red-600 text-white transition-all active:scale-95 disabled:opacity-10"
                        disabled={!cart[item.id]}
                      >
                        <Minus size={20} strokeWidth={3} />
                      </button>
                      <div className="w-12 text-center font-black text-xl">{cart[item.id]?.quantity || 0}</div>
                      <button 
                        onClick={() => updateQuantity(item, 1)}
                        className="flex-1 h-12 flex items-center justify-center rounded-2xl bg-neutral-800 hover:bg-red-600 text-white transition-all active:scale-95"
                      >
                        <Plus size={20} strokeWidth={3} />
                      </button>
                    </div>
                  </div>
                ))}
              </div>
            </div>
          ))}
        </div>

        {/* Carrito Sticky */}
        <aside className="lg:col-span-4 lg:sticky lg:top-28 h-fit">
          <div className="bg-neutral-900 border border-white/10 rounded-[3rem] p-8 sm:p-10 shadow-2xl relative overflow-hidden">
            <div className="absolute top-0 right-0 w-32 h-32 bg-red-600/10 blur-[60px] rounded-full -mr-16 -mt-16" />
            
            <h3 className="text-2xl font-black mb-8 flex items-center gap-3">
              <ShoppingBag className="text-red-600" /> RESUMEN
            </h3>

            {cartValues.count === 0 ? (
              <div className="text-center py-10 opacity-30">
                <ShoppingBag size={48} className="mx-auto mb-4" strokeWidth={1} />
                <p className="text-xs font-black uppercase tracking-widest">Carrito Vac√≠o</p>
              </div>
            ) : (
              <div className="space-y-8">
                <div className="space-y-4 max-h-[30vh] overflow-y-auto pr-2 scrollbar-hide">
                  {Object.values(cart).map((item) => (
                    <div key={item.id} className="flex justify-between items-center group animate-in slide-in-from-right-2">
                      <div className="flex items-center gap-4">
                        <div className="text-lg bg-neutral-800 w-10 h-10 rounded-xl flex items-center justify-center">{item.emoji}</div>
                        <div>
                          <p className="text-[11px] font-black uppercase leading-none">{item.name}</p>
                          <p className="text-[10px] text-red-500 font-bold mt-1 uppercase">{item.quantity} Unidad(es)</p>
                        </div>
                      </div>
                      <button onClick={() => updateQuantity(item, -item.quantity)} className="text-neutral-700 hover:text-red-500 transition-colors p-2">
                        <Trash2 size={16} />
                      </button>
                    </div>
                  ))}
                </div>

                <div className="space-y-6 pt-6 border-t border-white/5">
                  <div className="grid grid-cols-2 gap-2 bg-black/50 p-1.5 rounded-2xl border border-white/5">
                    <button 
                      onClick={() => setDeliveryType('recoger')}
                      className={`py-3 rounded-xl font-black text-[10px] tracking-widest transition-all ${deliveryType === 'recoger' ? 'bg-neutral-800 text-white shadow-xl' : 'text-neutral-600'}`}
                    >
                      RECOGER
                    </button>
                    <button 
                      onClick={() => setDeliveryType('delivery')}
                      className={`py-3 rounded-xl font-black text-[10px] tracking-widest transition-all ${deliveryType === 'delivery' ? 'bg-neutral-800 text-white shadow-xl' : 'text-neutral-600'}`}
                    >
                      DELIVERY
                    </button>
                  </div>

                  {deliveryType === 'delivery' && (
                    <div className="space-y-3 animate-in fade-in duration-500">
                      <input 
                        type="text" 
                        placeholder="NOMBRE COMPLETO" 
                        className="w-full bg-black/40 border border-white/5 rounded-2xl py-4 px-5 text-xs font-bold focus:border-red-600 transition-all outline-none" 
                        value={customerInfo.name} 
                        onChange={e => setCustomerInfo({...customerInfo, name: e.target.value})} 
                      />
                      <input 
                        type="tel" 
                        placeholder="TEL√âFONO" 
                        className="w-full bg-black/40 border border-white/5 rounded-2xl py-4 px-5 text-xs font-bold focus:border-red-600 transition-all outline-none" 
                        value={customerInfo.phone} 
                        onChange={e => setCustomerInfo({...customerInfo, phone: e.target.value})} 
                      />
                      <textarea 
                        placeholder="DIRECCI√ìN" 
                        className="w-full bg-black/40 border border-white/5 rounded-2xl py-4 px-5 text-xs font-bold focus:border-red-600 transition-all outline-none h-24 resize-none" 
                        value={customerInfo.address} 
                        onChange={e => setCustomerInfo({...customerInfo, address: e.target.value})} 
                      />
                    </div>
                  )}

                  <div className="flex justify-between items-center bg-black/40 p-6 rounded-[2rem] border border-white/5">
                    <span className="text-[10px] font-black text-neutral-500 uppercase tracking-[0.2em]">Total</span>
                    <span className="text-4xl font-black text-white tracking-tighter">${cartValues.total}</span>
                  </div>

                  <button 
                    onClick={sendOrder}
                    className="w-full bg-green-600 hover:bg-green-500 text-white font-black py-6 rounded-[2rem] shadow-2xl shadow-green-900/20 transition-all active:scale-[0.97] flex items-center justify-center gap-4 text-sm tracking-tight"
                  >
                    <MessageCircle size={24} fill="currentColor" /> PEDIR POR WHATSAPP
                  </button>
                </div>
              </div>
            )}
          </div>
        </aside>
      </main>

      <footer className="bg-black py-20 px-6 border-t border-white/5">
        <div className="max-w-7xl mx-auto flex flex-col items-center text-center gap-8">
          <LogoImage className="w-24 h-24" alt="Footer Logo" />
          <div>
            <h4 className="text-2xl font-black tracking-tighter mb-2">SE ESCAP√ì EL POLLO</h4>
            <p className="text-neutral-600 text-[10px] font-bold tracking-[0.3em] uppercase">The Best Chicken in NJ</p>
          </div>
          <div className="flex gap-8">
            <a href={`tel:${WHATSAPP_NUMBER}`} className="text-neutral-400 hover:text-white transition-colors"><Phone size={24} /></a>
            <a href="#" className="text-neutral-400 hover:text-white transition-colors"><MessageCircle size={24} /></a>
          </div>
          <p className="text-neutral-800 text-[9px] font-black uppercase mt-10">¬© {new Date().getFullYear()} ¬∑ Hecho con ‚ù§Ô∏è para NJ</p>
        </div>
      </footer>

      {/* Estilos Globales para Producci√≥n */}
      <style dangerouslySetInnerHTML={{ __html: `
        :root {
          color-scheme: dark;
        }
        * {
          -webkit-tap-highlight-color: transparent;
          -webkit-font-smoothing: antialiased;
        }
        body {
          background-color: #050505;
          margin: 0;
          padding: 0;
        }
        .pt-safe { padding-top: env(safe-area-inset-top); }
        .pb-safe { padding-bottom: env(safe-area-inset-bottom); }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        
        @keyframes fadeIn { 
          from { opacity: 0; transform: translateY(20px); } 
          to { opacity: 1; transform: translateY(0); } 
        }
        .animate-in { 
          animation: fadeIn 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards; 
        }

        /* Optimizaci√≥n para GitHub Pages (Rutas relativas y Base) */
        @media (max-width: 640px) {
          .text-7xl { font-size: 3.5rem; }
        }
      `}} />
    </div>
  );
}
